<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Administra√ß√£o - FinanceSync Pro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #3b82f6;
            --accent-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --info-color: #06b6d4;
            --dark-color: #1e293b;
            --light-color: #f8fafc;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
            color: var(--dark-color);
        }

        /* Scrollbar customizado */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--light-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--primary-color), var(--accent-color));
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, var(--secondary-color), var(--accent-color));
        }

        .sidebar {
            min-height: 100vh;
            background: linear-gradient(180deg, #1e293b 0%, #334155 50%, #475569 100%);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow-xl);
        }
        
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            margin: 4px 8px;
            padding: 12px 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            display: flex;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .sidebar .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .sidebar .nav-link:hover::before {
            left: 100%;
        }

        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            color: white;
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.3), rgba(16, 185, 129, 0.3));
            border: 1px solid rgba(255, 255, 255, 0.1);
            transform: translateX(8px) scale(1.02);
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.2);
        }

        .sidebar .nav-link.active {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4);
        }

        .sidebar-header {
            padding: 2rem 1rem;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 1rem;
        }

        .sidebar-logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.3);
        }

        .user-area {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 1rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .user-info {
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: var(--dark-color);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            margin-right: 0.75rem;
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 0;
        }

        .user-role {
            font-size: 0.75rem;
            color: var(--light-text);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .user-dropdown {
            border: none;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .main-content {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            margin: 1rem;
            padding: 2rem;
            box-shadow: var(--shadow-lg);
        }

        .page-header {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.1), rgba(16, 185, 129, 0.1));
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(37, 99, 235, 0.1);
        }

        .icon-gradient {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .admin-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            margin: 2rem auto;
            max-width: 1400px;
            min-height: calc(100vh - 4rem);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card {
            border: none;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            position: relative;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
        }

        .card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            border-radius: 20px 20px 0 0 !important;
            padding: 1.5rem;
            border: none;
        }

        .table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 0;
        }

        .table thead {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
        }

        .table thead th {
            border: none;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.5px;
            padding: 1rem;
        }

        .table tbody td {
            border: none;
            padding: 1rem;
            vertical-align: middle;
        }

        .table tbody tr {
            border-bottom: 1px solid var(--border-color);
            transition: all 0.2s;
        }

        .table tbody tr:hover {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.05), rgba(16, 185, 129, 0.05));
            transform: scale(1.01);
        }

        .badge {
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.5px;
        }

        .btn {
            border-radius: 12px;
            padding: 10px 24px;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.875rem;
            letter-spacing: 0.5px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            border: none;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(37, 99, 235, 0.3);
        }

        .btn-sm {
            padding: 0.25rem 0.75rem;
            font-size: 0.875rem;
        }

        .status-ativo {
            color: var(--success-color);
        }

        .status-inativo {
            color: var(--danger-color);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .modal-content {
            border-radius: 20px;
            border: none;
            backdrop-filter: blur(20px);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 20px 20px 0 0;
        }

        .form-control, .form-select {
            border-radius: 10px;
            border: 1px solid var(--border-color);
            padding: 0.75rem 1rem;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .stats-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .status-ativo {
            color: var(--accent-color);
        }

        .status-inativo {
            color: var(--danger-color);
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--light-text);
        }

        .avatar {
            font-weight: 600;
            font-size: 0.875rem;
        }

        .badge.admin {
            background: linear-gradient(135deg, var(--danger-color), #dc2626);
        }

        .badge.auditor {
            background: linear-gradient(135deg, var(--info-color), #0891b2);
        }

        .badge.usuario {
            background: linear-gradient(135deg, var(--accent-color), #059669);
            color: white;
        }

        /* Ajustar largura do card de usu√°rios para ficar igual ao header */
        #tab-usuarios .card {
            width: 100%;
            max-width: none;
        }

        #tab-usuarios .row {
            margin: 0;
        }

        #tab-usuarios .col {
            padding: 0;
        }

        /* Garantir que o card ocupe toda a largura dispon√≠vel */
        .main-content .card {
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        }

        /* Estilos para o perfil do usu√°rio */
        .profile-avatar {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.3);
            transition: all 0.3s ease;
        }

        .profile-avatar:hover {
            transform: scale(1.05);
        }

        .stats-item {
            padding: 1rem;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            margin: 0.5rem 0;
            transition: all 0.3s ease;
        }

        .stats-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        /* Melhorar apar√™ncia dos modais */
        .modal-content {
            border-radius: 20px;
            border: none;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .modal-header {
            border-radius: 20px 20px 0 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .modal-footer {
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 0 0 20px 20px;
        }

        /* Estilos espec√≠ficos para tabela de usu√°rios */
        #tabela-usuarios {
            min-width: 1000px;
            width: 100%;
        }

        #tabela-usuarios th,
        #tabela-usuarios td {
            white-space: nowrap;
            padding: 0.75rem 0.5rem;
        }

        #tabela-usuarios th:first-child,
        #tabela-usuarios td:first-child {
            min-width: 200px;
        }

        #tabela-usuarios th:nth-child(2),
        #tabela-usuarios td:nth-child(2) {
            min-width: 180px;
        }

        #tabela-usuarios th:nth-child(3),
        #tabela-usuarios td:nth-child(3) {
            min-width: 100px;
        }

        #tabela-usuarios th:nth-child(4),
        #tabela-usuarios td:nth-child(4) {
            min-width: 80px;
        }

        #tabela-usuarios th:nth-child(5),
        #tabela-usuarios td:nth-child(5) {
            min-width: 120px;
        }

        #tabela-usuarios th:nth-child(6),
        #tabela-usuarios td:nth-child(6) {
            min-width: 120px;
        }

        #tabela-usuarios th:last-child,
        #tabela-usuarios td:last-child {
            min-width: 150px;
        }

        .table-responsive {
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        /* Garantir largura completa para todas as tabs */
        .tab-pane {
            width: 100%;
            max-width: none;
        }

        .tab-pane .card,
        .tab-pane .row {
            width: 100%;
            max-width: none;
        }

        /* Ajustes espec√≠ficos para as tabs */
        #tab-usuarios .card,
        #tab-permissoes .card,
        #tab-logs .card {
            margin-bottom: 0;
        }

        /* Melhorar espa√ßamento das permiss√µes */
        #tab-permissoes .card {
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        #tab-permissoes .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        /* Otimiza√ß√£o para layout mais largo */
        .sidebar {
            min-width: 200px;
        }

        main.col-md-10 {
            width: 83.33333333% !important;
            flex: 0 0 auto;
        }

        .main-content {
            width: 100%;
            max-width: none;
        }

        /* Melhorar espa√ßamento da tabela no layout mais largo */
        #tabela-usuarios {
            width: 100%;
            table-layout: auto;
        }

        .table-responsive {
            overflow-x: auto;
            width: 100%;
        }

        /* Alinhamento perfeito entre Painel de Administra√ß√£o e Gerenciamento de Usu√°rios */
        .tab-content {
            padding: 0 !important;
            margin: 0 !important;
        }

        /* Garantir que todas as tabs tenham exatamente o mesmo alinhamento do Painel */
        #tab-usuarios,
        #tab-permissoes,
        #tab-logs {
            padding: 0 !important;
            margin: 0 !important;
        }

        #tab-usuarios .row,
        #tab-permissoes .row,
        #tab-logs .row {
            margin: 0 !important;
        }

        #tab-usuarios .col,
        #tab-permissoes .col,
        #tab-logs .col {
            padding: 0 !important;
        }

        /* Garantir mesmo alinhamento lateral para TODAS as se√ß√µes */
        .page-header,
        .tab-pane {
            padding-left: 8px !important;
            padding-right: 8px !important;
            margin-left: -3px !important;
            margin-right: -3px !important;
        }

        .tab-content {
            padding: 5px 8px !important;
            margin: 0 -5px !important;
            overflow: visible !important;
        }

        /* Padronizar largura de todos os cards */
        .page-header .card-dashboard,
        #tab-usuarios .card,
        #tab-permissoes .card,
        #tab-logs .card {
            width: 100% !important;
            margin: 0 !important;
        }

        /* Remover qualquer padding extra que possa causar desalinhamento */
        .main-content {
            padding-left: 0 !important;
            padding-right: 0 !important;
        }

        /* Garantir que o container principal tenha largura consistente */
        main.col-md-10 {
            padding-left: 1.5rem !important;
            padding-right: 1.5rem !important;
        }

        /* Estilos espec√≠ficos para a se√ß√£o de Logs */
        .table-container-logs {
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .table-container-logs::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .table-container-logs::-webkit-scrollbar-track {
            background: var(--light-color);
            border-radius: 4px;
        }

        .table-container-logs::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--primary-color), var(--accent-color));
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .table-container-logs::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, var(--secondary-color), var(--accent-color));
        }

        /* Corrigir altura da se√ß√£o de logs para evitar esticamento */
        #tab-logs .card-body {
            max-height: none;
            overflow: visible;
        }

        /* Garantir que as estat√≠sticas tenham tamanho consistente */
        #tab-logs .row.mt-4 .card {
            min-height: 100px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: transform 0.2s ease;
        }

        #tab-logs .row.mt-4 .card:hover {
            transform: translateY(-2px);
        }

        /* Melhorar responsividade da tabela de logs */
        @media (max-width: 768px) {
            .table-container-logs {
                max-height: 300px;
            }
            
            #tab-logs .row.mt-4 .col-lg-3 {
                margin-bottom: 15px;
            }
        }

        /* Corrigir avatar na coluna usu√°rio dos logs */
        #tabela-logs .avatar {
            width: 30px !important;
            height: 30px !important;
            min-width: 30px !important;
            min-height: 30px !important;
            flex-shrink: 0;
            font-size: 0.8rem !important;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Melhorar layout da coluna usu√°rio */
        #tabela-logs td:nth-child(2) {
            white-space: nowrap;
        }

        #tabela-logs td:nth-child(2) .d-flex {
            align-items: center;
            gap: 8px;
        }

        #tabela-logs td:nth-child(2) span {
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100px;
        }

        /* Corrigir sombra cortada do Painel de Administra√ß√£o */
        .page-header {
            padding-left: 8px !important;
            padding-right: 8px !important;
            margin-left: -3px !important;
            margin-right: -3px !important;
        }

        .page-header .card-dashboard {
            margin-left: 0 !important;
            margin-right: 0 !important;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08) !important;
        }

        /* Garantir que o container principal tenha espa√ßo para sombras */
        main.col-md-10 {
            padding-left: 1.5rem !important;
            padding-right: 1.5rem !important;
            overflow: visible !important;
        }

        /* Ajustar container das tabs para ter espa√ßo para sombras */
        .tab-content {
            overflow: visible !important;
            padding: 5px 8px !important;
            margin: 0 -5px !important;
        }

        /* Reduzir tamanho da box do cabe√ßalho */
        .page-header {
            padding: 15px 8px !important;
            margin-bottom: 15px !important;
        }

        .page-header h1 {
            font-size: 1.8rem !important;
            margin-bottom: 5px !important;
        }

        .page-header p {
            font-size: 0.9rem !important;
        }

        .card-dashboard {
            border-radius: 12px !important;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color)) !important;
            border: none !important;
            position: relative !important;
            z-index: 1 !important;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.25) !important;
            transition: all 0.3s ease !important;
        }

        .card-dashboard:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.35) !important;
        }

        /* Estilos para boxes clic√°veis */
        .clickable-stat {
            user-select: none;
            transition: all 0.3s ease !important;
        }

        .clickable-stat:hover {
            transform: translateY(-3px) scale(1.02) !important;
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4) !important;
        }

        .clickable-stat:active {
            transform: translateY(-1px) scale(0.98) !important;
        }

        .clickable-stat.active {
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.3), 0 6px 20px rgba(37, 99, 235, 0.35) !important;
            transform: translateY(-2px) !important;
        }

        .clickable-stat::after {
            content: 'üëÜ';
            position: absolute;
            top: -5px;
            right: -5px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .clickable-stat:hover::after {
            opacity: 1;
        }

        /* Posicionamento das boxes centralizadas */
        .page-header .d-flex.justify-content-center {
            max-width: 480px; /* Largura fixa para as 3 boxes */
        }

        .page-header .d-flex.gap-2 {
            flex-wrap: nowrap;
            justify-content: center;
        }

        /* Prevenir overflow horizontal na p√°gina */
        body, html {
            overflow-x: hidden !important;
        }

        .container-fluid {
            overflow-x: hidden !important;
        }

        .row {
            margin-left: 0 !important;
            margin-right: 0 !important;
        }

        /* Responsividade para telas menores */
        @media (max-width: 1400px) {
            .page-header .d-flex.gap-2 {
                gap: 0.5rem !important;
            }
            
            .card-dashboard {
                max-width: 130px !important;
                padding: 0.5rem !important;
            }

            .sidebar-logo {
                width: 32px !important;
                height: 32px !important;
            }
        }

        @media (max-width: 1200px) {
            .page-header .d-flex.justify-content-center {
                max-width: 400px;
                margin-right: 150px !important;
            }
            
            .page-header .d-flex.gap-2 {
                gap: 0.25rem !important;
            }
            
            .card-dashboard {
                max-width: 110px !important;
                padding: 0.4rem !important;
            }
            
            .sidebar-logo {
                width: 28px !important;
                height: 28px !important;
            }

            .card-dashboard small {
                font-size: 0.6rem !important;
            }
        }

        @media (max-width: 992px) {
            .page-header .d-flex.align-items-center.flex-grow-1 {
                flex-direction: column;
                align-items: center !important;
                gap: 20px;
            }
            
            .page-header .d-flex.justify-content-center {
                max-width: 100%;
                justify-content: center;
            }

            .card-dashboard {
                max-width: 100px !important;
                padding: 0.3rem !important;
            }

            .card-dashboard h6 {
                font-size: 0.9rem !important;
            }

            .card-dashboard small {
                font-size: 0.55rem !important;
            }
        }

        @media (max-width: 768px) {
            .page-header .d-flex.gap-2 {
                flex-direction: column;
                gap: 0.5rem !important;
            }

            .card-dashboard {
                max-width: 100% !important;
                padding: 0.5rem !important;
            }
        }
    </style>
</head>
<body>
    <!-- √Årea do Usu√°rio -->
    <div class="user-area">
        <div class="dropdown">
            <div class="user-info dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" role="button">
                <div class="user-avatar" id="user-avatar">A</div>
                <div class="user-details">
                    <div class="user-name" id="user-name">Admin</div>
                    <div class="user-role">Administrador</div>
                </div>
                <i class="fas fa-chevron-down ms-2 text-muted"></i>
            </div>
            <ul class="dropdown-menu user-dropdown">
                <li>
                    <a class="dropdown-item" href="/">
                        <i class="fas fa-arrow-left me-2"></i>Voltar ao Dashboard
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="#" onclick="abrirPerfilUsuario()">
                        <i class="fas fa-user me-2"></i>Meu Perfil
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="#" onclick="abrirConfiguracoes()">
                        <i class="fas fa-cog me-2"></i>Configura√ß√µes
                    </a>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li>
                    <a class="dropdown-item text-danger" href="#" onclick="confirmarLogout()">
                        <i class="fas fa-sign-out-alt me-2"></i>Sair do Sistema
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-2 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <div class="sidebar-header">
                        <div class="sidebar-logo">
                            <i class="fas fa-users-cog fa-2x text-white"></i>
                        </div>
                        <h4 class="text-white fw-bold">Admin Panel</h4>
                        <small class="text-white-50 text-uppercase tracking-wider">Sistema de Controle</small>
                    </div>
                    
                    <ul class="nav flex-column px-2">
                        <li class="nav-item">
                            <a class="nav-link active" href="#usuarios" data-tab="usuarios">
                                <i class="fas fa-users me-3"></i>
                                <span>Usu√°rios</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#permissoes" data-tab="permissoes">
                                <i class="fas fa-shield-alt me-3"></i>
                                <span>Permiss√µes</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#logs" data-tab="logs">
                                <i class="fas fa-history me-3"></i>
                                <span>Logs de Auditoria</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main content -->
            <main class="col-md-10 ms-sm-auto col-lg-10 px-md-4">
                <div class="main-content">
                    <div class="page-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="d-flex align-items-center flex-grow-1 justify-content-between">
                                <div class="me-4">
                                    <h1 class="h2 fw-bold mb-2">
                                        <i class="fas fa-users-cog icon-gradient me-3"></i>Painel de Administra√ß√£o
                                    </h1>
                                    <p class="text-muted mb-0">Gerencie usu√°rios e permiss√µes do sistema</p>
                                </div>
                                <div class="d-flex justify-content-center flex-grow-1" style="margin-right: 200px;">
                                    <div class="d-flex gap-2">
                                        <div class="card-dashboard clickable-stat" data-filter="ativos" style="padding: 0.6rem; max-width: 140px; cursor: pointer;" onclick="filtrarPorStatus('ativos')">
                                            <div class="d-flex align-items-center">
                                                <div class="sidebar-logo me-2" style="width: 35px; height: 35px; background: linear-gradient(135deg, var(--accent-color), #059669);">
                                                    <i class="fas fa-users text-white" style="font-size: 0.9rem;"></i>
                                                </div>
                                                <div>
                                                    <div class="h6 mb-0" id="total-usuarios">-</div>
                                                    <small class="text-white opacity-75" style="font-size: 0.7rem;">Usu√°rios Ativos</small>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Box Usu√°rios Inativos -->
                                        <div class="card-dashboard clickable-stat" data-filter="inativos" style="padding: 0.6rem; max-width: 140px; cursor: pointer;" onclick="filtrarPorStatus('inativos')">
                                            <div class="d-flex align-items-center">
                                                <div class="sidebar-logo me-2" style="width: 35px; height: 35px; background: linear-gradient(135deg, var(--accent-color), #059669);">
                                                    <i class="fas fa-user-slash text-white" style="font-size: 0.9rem;"></i>
                                                </div>
                                                <div>
                                                    <div class="h6 mb-0 text-white" id="total-inativos">-</div>
                                                    <small class="text-white opacity-75" style="font-size: 0.7rem;">Usu√°rios Inativos</small>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Box Total de Usu√°rios -->
                                        <div class="card-dashboard clickable-stat" data-filter="todos" style="padding: 0.6rem; max-width: 140px; cursor: pointer;" onclick="filtrarPorStatus('todos')">
                                            <div class="d-flex align-items-center">
                                                <div class="sidebar-logo me-2" style="width: 35px; height: 35px; background: linear-gradient(135deg, var(--accent-color), #059669);">
                                                    <i class="fas fa-users-cog text-white" style="font-size: 0.9rem;"></i>
                                                </div>
                                                <div>
                                                    <div class="h6 mb-0 text-white" id="total-todos">-</div>
                                                    <small class="text-white opacity-75" style="font-size: 0.7rem;">Total Criados</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div style="width: 50px;"></div> <!-- Espa√ßo reservado reduzido -->
                            </div>
                        </div>
                    </div>

                    <div class="tab-content">
                        <!-- Tab: Usu√°rios -->
                        <div id="tab-usuarios" class="tab-pane fade show active" role="tabpanel">
                            <div class="row mb-4">
                                <div class="col">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5 class="mb-0">
                                                <i class="fas fa-users me-2"></i>
                                                Gerenciamento de Usu√°rios
                                            </h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between mb-3">
                                                <div class="d-flex gap-2">
                                                    <button class="btn btn-primary" onclick="atualizarUsuarios()">
                                                        <i class="fas fa-sync-alt me-2"></i>Atualizar
                                                    </button>
                                                </div>
                                                <div class="d-flex gap-2">
                                                    <select class="form-select" id="filtro-perfil" onchange="filtrarUsuarios()">
                                                        <option value="">Todos os perfis</option>
                                                        <option value="admin">Administradores</option>
                                                        <option value="auditor">Auditores</option>
                                                        <option value="usuario">Usu√°rios</option>
                                                    </select>
                                        </div>
                                    </div>

                                    <div class="loading" id="loading-usuarios">
                                        <i class="fas fa-spinner fa-spin fa-2x text-primary"></i>
                                        <p class="mt-2">Carregando usu√°rios...</p>
                                    </div>

                                    <div class="table-responsive">
                                        <table class="table table-hover" id="tabela-usuarios">
                                            <thead>
                                                <tr>
                                                    <th>Usu√°rio</th>
                                                    <th>Email</th>
                                                    <th>Perfil</th>
                                                    <th>Status</th>
                                                    <th>√öltimo Acesso</th>
                                                    <th>Estat√≠sticas</th>
                                                    <th class="text-center">A√ß√µes</th>
                                                </tr>
                                            </thead>
                                            <tbody id="lista-usuarios">
                                                <!-- Usu√°rios ser√£o carregados aqui -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab: Permiss√µes -->
                <div id="tab-permissoes" class="tab-pane fade" role="tabpanel">
                    <div class="row">
                        <div class="col">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">
                                        <i class="fas fa-user-shield me-2"></i>
                                        Gerenciamento de Permiss√µes
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-lg-4 mb-4">
                                            <div class="card h-100">
                                                <div class="card-header">
                                                    <h6 class="mb-0">üëë Administrador</h6>
                                                </div>
                                                <div class="card-body">
                                                    <ul class="list-unstyled mb-0">
                                                        <li><i class="fas fa-check text-success me-2"></i>Acesso total ao sistema</li>
                                                        <li><i class="fas fa-check text-success me-2"></i>Gerenciar usu√°rios</li>
                                                        <li><i class="fas fa-check text-success me-2"></i>Ver todos os dados</li>
                                                        <li><i class="fas fa-check text-success me-2"></i>Modificar qualquer registro</li>
                                                        <li><i class="fas fa-check text-success me-2"></i>Logs de auditoria</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-4 mb-4">
                                            <div class="card h-100">
                                                <div class="card-header">
                                                    <h6 class="mb-0">üîç Auditor</h6>
                                                </div>
                                                <div class="card-body">
                                                    <ul class="list-unstyled mb-0">
                                                        <li><i class="fas fa-check text-success me-2"></i>Acesso de leitura total</li>
                                                        <li><i class="fas fa-times text-danger me-2"></i>N√£o pode modificar dados</li>
                                                        <li><i class="fas fa-check text-success me-2"></i>Ver todos os relat√≥rios</li>
                                                        <li><i class="fas fa-check text-success me-2"></i>Exportar dados</li>
                                                        <li><i class="fas fa-check text-success me-2"></i>Controle de qualidade</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-4 mb-4">
                                            <div class="card h-100">
                                                <div class="card-header">
                                                    <h6 class="mb-0">üë§ Usu√°rio</h6>
                                                </div>
                                                <div class="card-body">
                                                    <ul class="list-unstyled mb-0">
                                                        <li><i class="fas fa-check text-success me-2"></i>Apenas pr√≥prios dados</li>
                                                        <li><i class="fas fa-check text-success me-2"></i>Criar concilia√ß√µes</li>
                                                        <li><i class="fas fa-check text-success me-2"></i>Relat√≥rios pessoais</li>
                                                        <li><i class="fas fa-times text-danger me-2"></i>N√£o v√™ outros usu√°rios</li>
                                                        <li><i class="fas fa-times text-danger me-2"></i>Sem acesso administrativo</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab: Logs -->
                <div id="tab-logs" class="tab-pane fade" role="tabpanel">
                    <div class="row">
                        <div class="col">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">
                                        <i class="fas fa-history me-2"></i>
                                        Logs de Auditoria
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div class="d-flex justify-content-between mb-3">
                                        <div class="d-flex gap-2">
                                            <button class="btn btn-primary" onclick="carregarLogs()">
                                                <i class="fas fa-sync-alt me-2"></i>Atualizar
                                            </button>
                                            <button class="btn btn-outline-secondary" onclick="exportarLogs()">
                                                <i class="fas fa-download me-2"></i>Exportar
                                            </button>
                                        </div>
                                        <div class="d-flex gap-2">
                                            <select class="form-select" id="filtro-acao" onchange="filtrarLogs()">
                                                <option value="">Todas as a√ß√µes</option>
                                                <option value="login">Login</option>
                                                <option value="logout">Logout</option>
                                                <option value="create">Criar</option>
                                                <option value="update">Atualizar</option>
                                                <option value="delete">Excluir</option>
                                            </select>
                                            <input type="date" class="form-control" id="data-filtro" onchange="filtrarLogs()">
                                        </div>
                                    </div>

                                    <div class="loading" id="loading-logs" style="display: none;">
                                        <i class="fas fa-spinner fa-spin fa-2x text-primary"></i>
                                        <p class="mt-2">Carregando logs...</p>
                                    </div>

                                    <!-- Container com scroll horizontal para a tabela -->
                                    <div class="table-container-logs" style="max-height: 400px; overflow-y: auto; overflow-x: auto; border: 1px solid #dee2e6; border-radius: 8px;">
                                        <table class="table table-hover mb-0" id="tabela-logs" style="min-width: 800px;">
                                            <thead class="table-light sticky-top">
                                                <tr>
                                                    <th style="min-width: 140px;">Data/Hora</th>
                                                    <th style="min-width: 120px;">Usu√°rio</th>
                                                    <th style="min-width: 100px;">A√ß√£o</th>
                                                    <th style="min-width: 100px;">Tabela</th>
                                                    <th style="min-width: 100px;">Registro ID</th>
                                                    <th style="min-width: 120px;">IP Address</th>
                                                    <th style="min-width: 100px;" class="text-center">Detalhes</th>
                                                </tr>
                                            </thead>
                                            <tbody id="lista-logs">
                                                <!-- Logs ser√£o carregados aqui -->
                                            </tbody>
                                        </table>
                                    </div>

                            <!-- Estat√≠sticas dos Logs -->
                            <div class="row mt-4 g-3">
                                <div class="col-lg-3 col-md-6">
                                    <div class="card bg-primary text-white h-100">
                                        <div class="card-body text-center d-flex flex-column justify-content-center">
                                            <h3 id="total-logs" class="mb-1">0</h3>
                                            <small>Total de Logs</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6">
                                    <div class="card bg-success text-white h-100">
                                        <div class="card-body text-center d-flex flex-column justify-content-center">
                                            <h3 id="logs-hoje" class="mb-1">0</h3>
                                            <small>Logs Hoje</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6">
                                    <div class="card bg-info text-white h-100">
                                        <div class="card-body text-center d-flex flex-column justify-content-center">
                                            <h3 id="usuarios-ativos" class="mb-1">0</h3>
                                            <small>Usu√°rios Ativos</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6">
                                    <div class="card bg-warning text-white h-100">
                                        <div class="card-body text-center d-flex flex-column justify-content-center">
                                            <h3 id="acoes-criticas" class="mb-1">0</h3>
                                            <small>A√ß√µes Cr√≠ticas</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal para editar usu√°rio -->
    <div class="modal fade" id="modalEditarUsuario" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-user-edit me-2"></i>
                        Editar Usu√°rio
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="form-editar-usuario">
                        <input type="hidden" id="edit-usuario-id">
                        
                        <div class="mb-3">
                            <label class="form-label">Nome de Usu√°rio</label>
                            <input type="text" class="form-control" id="edit-username" readonly>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="edit-email" readonly>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Perfil</label>
                            <select class="form-select" id="edit-perfil">
                                <option value="usuario">üë§ Usu√°rio</option>
                                <option value="auditor">üîç Auditor</option>
                                <option value="admin">üëë Administrador</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="edit-status">
                                <option value="true">‚úÖ Ativo</option>
                                <option value="false">‚ùå Inativo</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="salvarUsuario()">
                        <i class="fas fa-save me-2"></i>Salvar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para resetar senha -->
    <div class="modal fade" id="modalResetarSenha" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-key me-2"></i>
                        Resetar Senha
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Tem certeza que deseja resetar a senha do usu√°rio <strong id="reset-username"></strong>?</p>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        A nova senha ser√°: <strong>senha123</strong>
                    </div>
                    <input type="hidden" id="reset-usuario-id">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-warning" onclick="confirmarResetarSenha()">
                        <i class="fas fa-key me-2"></i>Resetar Senha
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Perfil do Usu√°rio -->
    <div class="modal fade" id="modalPerfilUsuario" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-user me-2"></i>
                        Meu Perfil
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Informa√ß√µes do Usu√°rio -->
                    <div class="row mb-4">
                        <div class="col-md-4 text-center">
                            <div class="profile-avatar mx-auto mb-3" id="profile-avatar">
                                <i class="fas fa-user fa-3x text-white"></i>
                            </div>
                            <button class="btn btn-outline-primary btn-sm" onclick="uploadFotoPerfil()">
                                <i class="fas fa-camera me-2"></i>Alterar Foto
                            </button>
                            <input type="file" id="upload-foto" accept="image/*" style="display: none;" onchange="processarFotoPerfil(this)">
                        </div>
                        <div class="col-md-8">
                            <div class="card border-0 bg-light">
                                <div class="card-body">
                                    <h6 class="card-title">
                                        <i class="fas fa-info-circle me-2"></i>Informa√ß√µes do Perfil
                                    </h6>
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <strong>Nome:</strong>
                                            <p id="profile-nome" class="mb-2">Usu√°rio Sistema</p>
                                        </div>
                                        <div class="col-sm-6">
                                            <strong>Email:</strong>
                                            <p id="profile-email" class="mb-2">usuario@financesync.com</p>
                                        </div>
                                        <div class="col-sm-6">
                                            <strong>Perfil:</strong>
                                            <p id="profile-perfil" class="mb-2">
                                                <span class="badge usuario">üë§ Usu√°rio</span>
                                            </p>
                                        </div>
                                        <div class="col-sm-6">
                                            <strong>√öltimo Acesso:</strong>
                                            <p id="profile-ultimo-acesso" class="mb-2">02/09/2025 22:58</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Funcionalidades Dispon√≠veis -->
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0">
                                <i class="fas fa-cogs me-2"></i>Em breve voc√™ poder√°:
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <ul class="list-unstyled">
                                        <li class="mb-2">
                                            <button class="btn btn-outline-primary btn-sm w-100" onclick="editarDadosPessoais()">
                                                <i class="fas fa-edit me-2"></i>Editar dados pessoais
                                            </button>
                                        </li>
                                        <li class="mb-2">
                                            <button class="btn btn-outline-warning btn-sm w-100" onclick="alterarSenha()">
                                                <i class="fas fa-key me-2"></i>Alterar senha
                                            </button>
                                        </li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <ul class="list-unstyled">
                                        <li class="mb-2">
                                            <button class="btn btn-outline-info btn-sm w-100" onclick="configurarPreferencias()">
                                                <i class="fas fa-sliders-h me-2"></i>Configurar prefer√™ncias
                                            </button>
                                        </li>
                                        <li class="mb-2">
                                            <button class="btn btn-outline-success btn-sm w-100" onclick="uploadFotoPerfil()">
                                                <i class="fas fa-camera me-2"></i>Upload de foto de perfil
                                            </button>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Estat√≠sticas do Usu√°rio -->
                    <div class="card mt-3">
                        <div class="card-header">
                            <h6 class="mb-0">
                                <i class="fas fa-chart-bar me-2"></i>Suas Estat√≠sticas
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row text-center">
                                <div class="col-3">
                                    <div class="stats-item">
                                        <div class="h4 text-primary mb-1" id="stats-extratos">0</div>
                                        <small class="text-muted">Extratos</small>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="stats-item">
                                        <div class="h4 text-info mb-1" id="stats-lancamentos">0</div>
                                        <small class="text-muted">Lan√ßamentos</small>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="stats-item">
                                        <div class="h4 text-success mb-1" id="stats-conciliacoes">0</div>
                                        <small class="text-muted">Concilia√ß√µes</small>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="stats-item">
                                        <div class="h4 text-warning mb-1" id="stats-divergencias">0</div>
                                        <small class="text-muted">Diverg√™ncias</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Editar Dados Pessoais -->
    <div class="modal fade" id="modalEditarDados" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-edit me-2"></i>Editar Dados Pessoais
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="form-editar-dados">
                        <div class="mb-3">
                            <label for="edit-nome" class="form-label">Nome Completo</label>
                            <input type="text" class="form-control" id="edit-nome" required>
                        </div>
                        <div class="mb-3">
                            <label for="edit-email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="edit-email" required>
                        </div>
                        <div class="mb-3">
                            <label for="edit-telefone" class="form-label">Telefone</label>
                            <input type="tel" class="form-control" id="edit-telefone">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="salvarDadosPessoais()">
                        <i class="fas fa-save me-2"></i>Salvar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Alterar Senha -->
    <div class="modal fade" id="modalAlterarSenha" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-key me-2"></i>Alterar Senha
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="form-alterar-senha">
                        <div class="mb-3">
                            <label for="senha-atual" class="form-label">Senha Atual</label>
                            <input type="password" class="form-control" id="senha-atual" required>
                        </div>
                        <div class="mb-3">
                            <label for="nova-senha" class="form-label">Nova Senha</label>
                            <input type="password" class="form-control" id="nova-senha" required minlength="6">
                            <div class="form-text">M√≠nimo 6 caracteres</div>
                        </div>
                        <div class="mb-3">
                            <label for="confirmar-senha" class="form-label">Confirmar Nova Senha</label>
                            <input type="password" class="form-control" id="confirmar-senha" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-warning" onclick="salvarNovaSenha()">
                        <i class="fas fa-key me-2"></i>Alterar Senha
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Detalhes do Log -->
    <div class="modal fade" id="modalDetalhesLog" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-info-circle me-2"></i>
                        Detalhes do Log de Auditoria
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6><i class="fas fa-clock me-2"></i>Informa√ß√µes Temporais</h6>
                            <p><strong>Data/Hora:</strong> <span id="log-data-hora">-</span></p>
                            <p><strong>Usu√°rio:</strong> <span id="log-usuario">-</span></p>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="fas fa-network-wired me-2"></i>Informa√ß√µes T√©cnicas</h6>
                            <p><strong>IP Address:</strong> <span id="log-ip">-</span></p>
                            <p><strong>ID do Log:</strong> <span id="log-id">-</span></p>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-12">
                            <h6><i class="fas fa-cog me-2"></i>Detalhes da A√ß√£o</h6>
                            <p><strong>A√ß√£o:</strong> <span id="log-acao" class="badge bg-primary">-</span></p>
                            <p><strong>Tabela:</strong> <span id="log-tabela">-</span></p>
                            <p><strong>Registro ID:</strong> <span id="log-registro-id">-</span></p>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-12">
                            <h6><i class="fas fa-database me-2"></i>Dados Anteriores</h6>
                            <pre id="log-dados-anteriores" class="bg-light p-3 rounded" style="max-height: 200px; overflow-y: auto;">N√£o dispon√≠vel</pre>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-12">
                            <h6><i class="fas fa-database me-2"></i>Dados Novos</h6>
                            <pre id="log-dados-novos" class="bg-light p-3 rounded" style="max-height: 200px; overflow-y: auto;">N√£o dispon√≠vel</pre>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let usuarios = [];

        // Navega√ß√£o entre tabs (usando Bootstrap)
        document.querySelectorAll('[data-tab]').forEach(tab => {
            tab.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remover active das tabs
                document.querySelectorAll('.sidebar .nav-link').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-pane').forEach(t => {
                    t.classList.remove('show', 'active');
                });
                
                // Ativar tab clicada
                this.classList.add('active');
                const targetTab = document.getElementById('tab-' + this.dataset.tab);
                if (targetTab) {
                    targetTab.classList.add('show', 'active');
                }
            });
        });

        // Carregar usu√°rios ao inicializar
        document.addEventListener('DOMContentLoaded', function() {
            atualizarUsuarios();
        });

        async function atualizarUsuarios() {
            const loading = document.getElementById('loading-usuarios');
            const tabela = document.getElementById('tabela-usuarios');
            
            loading.style.display = 'block';
            tabela.style.display = 'none';
            
            try {
                const response = await fetch('/api/admin/usuarios');
                const data = await response.json();
                
                if (data.usuarios) {
                    usuarios = data.usuarios;
                    renderizarUsuarios(usuarios);
                    
                    // Atualizar estat√≠sticas das boxes
                    const usuariosAtivos = usuarios.filter(u => u.ativo).length;
                    const usuariosInativos = usuarios.filter(u => !u.ativo).length;
                    const totalUsuarios = usuarios.length;
                    
                    document.getElementById('total-usuarios').textContent = usuariosAtivos;
                    document.getElementById('total-inativos').textContent = usuariosInativos;
                    document.getElementById('total-todos').textContent = totalUsuarios;
                } else {
                    throw new Error(data.error || 'Erro ao carregar usu√°rios');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao carregar usu√°rios: ' + error.message);
            } finally {
                loading.style.display = 'none';
                tabela.style.display = 'table';
            }
        }

        function renderizarUsuarios(usuariosList) {
            const tbody = document.getElementById('lista-usuarios');
            
            tbody.innerHTML = usuariosList.map(usuario => `
                <tr>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="avatar bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3" 
                                 style="width: 40px; height: 40px;">
                                ${usuario.nome_completo.charAt(0).toUpperCase()}
                            </div>
                            <div>
                                <div class="fw-bold">${usuario.nome_completo}</div>
                                <small class="text-muted">@${usuario.username}</small>
                            </div>
                        </div>
                    </td>
                    <td>${usuario.email}</td>
                    <td>
                        <span class="badge ${usuario.perfil}">
                            ${usuario.perfil === 'admin' ? 'üëë' : usuario.perfil === 'auditor' ? 'üîç' : 'üë§'} 
                            ${usuario.perfil.charAt(0).toUpperCase() + usuario.perfil.slice(1)}
                        </span>
                    </td>
                    <td>
                        <i class="fas fa-circle ${usuario.ativo ? 'status-ativo' : 'status-inativo'} me-2"></i>
                        ${usuario.ativo ? 'Ativo' : 'Inativo'}
                    </td>
                    <td>
                        <small>${usuario.ultimo_acesso}</small>
                    </td>
                    <td>
                        <small>
                            ${usuario.estatisticas.extratos} extratos<br>
                            ${usuario.estatisticas.conciliacoes} concilia√ß√µes
                        </small>
                    </td>
                    <td class="text-center">
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary btn-sm" onclick="editarUsuario(${usuario.id})" 
                                    title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-outline-warning btn-sm" onclick="resetarSenha(${usuario.id})" 
                                    title="Resetar Senha">
                                <i class="fas fa-key"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function filtrarUsuarios() {
            // Remove filtro ativo das boxes ao usar filtro por perfil
            document.querySelectorAll('.clickable-stat').forEach(box => {
                box.classList.remove('active');
            });
            
            const filtro = document.getElementById('filtro-perfil').value;
            const usuariosFiltrados = filtro ? usuarios.filter(u => u.perfil === filtro) : usuarios;
            renderizarUsuarios(usuariosFiltrados);
            
            // Remove feedback anterior se existir
            const feedback = document.getElementById('filtro-feedback');
            if (feedback) {
                feedback.remove();
            }
        }

        // Fun√ß√£o para filtrar por status quando clicar nas boxes
        function filtrarPorStatus(tipo) {
            let usuariosFiltrados;
            
            // Remove classe active de todas as boxes
            document.querySelectorAll('.clickable-stat').forEach(box => {
                box.classList.remove('active');
            });
            
            // Adiciona classe active na box clicada
            document.querySelector(`[data-filter="${tipo}"]`).classList.add('active');
            
            // Reseta o filtro de perfil
            document.getElementById('filtro-perfil').value = '';
            
            // Filtra baseado no tipo
            switch(tipo) {
                case 'ativos':
                    usuariosFiltrados = usuarios.filter(u => u.ativo === true);
                    break;
                case 'inativos':
                    usuariosFiltrados = usuarios.filter(u => u.ativo === false);
                    break;
                case 'todos':
                default:
                    usuariosFiltrados = usuarios;
                    break;
            }
            
            renderizarUsuarios(usuariosFiltrados);
            
            // Mostrar feedback visual
            mostrarFeedbackFiltro(tipo, usuariosFiltrados.length);
        }

        // Fun√ß√£o para mostrar feedback do filtro
        function mostrarFeedbackFiltro(tipo, quantidade) {
            const mensagens = {
                'ativos': `Exibindo ${quantidade} usu√°rio(s) ativo(s)`,
                'inativos': `Exibindo ${quantidade} usu√°rio(s) inativo(s)`,
                'todos': `Exibindo todos os ${quantidade} usu√°rio(s)`
            };
            
            // Criar elemento de feedback se n√£o existir
            let feedback = document.getElementById('filtro-feedback');
            if (!feedback) {
                feedback = document.createElement('div');
                feedback.id = 'filtro-feedback';
                feedback.className = 'alert alert-info alert-dismissible fade show mt-2';
                feedback.style.cssText = 'font-size: 0.9rem; padding: 0.5rem 1rem; margin-bottom: 1rem;';
                
                const tabelaContainer = document.querySelector('#tab-usuarios .card-body');
                tabelaContainer.insertBefore(feedback, tabelaContainer.querySelector('.table-responsive'));
            }
            
            feedback.innerHTML = `
                <i class="fas fa-filter me-2"></i>${mensagens[tipo]}
                <button type="button" class="btn-close" data-bs-dismiss="alert" onclick="limparFiltroStatus()"></button>
            `;
            
            // Remove o feedback ap√≥s 5 segundos
            setTimeout(() => {
                if (feedback && feedback.parentNode) {
                    feedback.remove();
                }
            }, 5000);
        }

        // Fun√ß√£o para limpar filtro de status
        function limparFiltroStatus() {
            document.querySelectorAll('.clickable-stat').forEach(box => {
                box.classList.remove('active');
            });
            renderizarUsuarios(usuarios);
            
            const feedback = document.getElementById('filtro-feedback');
            if (feedback) {
                feedback.remove();
            }
        }

        function editarUsuario(id) {
            const usuario = usuarios.find(u => u.id === id);
            if (!usuario) return;

            document.getElementById('edit-usuario-id').value = usuario.id;
            document.getElementById('edit-username').value = usuario.username;
            document.getElementById('edit-email').value = usuario.email;
            document.getElementById('edit-perfil').value = usuario.perfil;
            document.getElementById('edit-status').value = usuario.ativo.toString();

            new bootstrap.Modal(document.getElementById('modalEditarUsuario')).show();
        }

        async function salvarUsuario() {
            const id = document.getElementById('edit-usuario-id').value;
            const perfil = document.getElementById('edit-perfil').value;
            const ativo = document.getElementById('edit-status').value === 'true';

            try {
                // Alterar perfil
                const perfilResponse = await fetch(`/api/admin/usuarios/${id}/perfil`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ perfil })
                });

                if (!perfilResponse.ok) throw new Error('Erro ao alterar perfil');

                // Alterar status
                const statusResponse = await fetch(`/api/admin/usuarios/${id}/status`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ativo })
                });

                if (!statusResponse.ok) throw new Error('Erro ao alterar status');

                bootstrap.Modal.getInstance(document.getElementById('modalEditarUsuario')).hide();
                await atualizarUsuarios();
                
                alert('Usu√°rio atualizado com sucesso!');
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao salvar usu√°rio: ' + error.message);
            }
        }

        function resetarSenha(id) {
            const usuario = usuarios.find(u => u.id === id);
            if (!usuario) return;

            document.getElementById('reset-usuario-id').value = usuario.id;
            document.getElementById('reset-username').textContent = usuario.username;

            new bootstrap.Modal(document.getElementById('modalResetarSenha')).show();
        }

        async function confirmarResetarSenha() {
            const id = document.getElementById('reset-usuario-id').value;

            try {
                const response = await fetch(`/api/admin/usuarios/${id}/resetar-senha`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ nova_senha: 'senha123' })
                });

                const data = await response.json();

                if (data.success) {
                    bootstrap.Modal.getInstance(document.getElementById('modalResetarSenha')).hide();
                    alert('Senha resetada com sucesso! Nova senha: ' + data.nova_senha);
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao resetar senha: ' + error.message);
            }
        }

        // === FUN√á√ïES DO PERFIL DO USU√ÅRIO ===

        function abrirPerfilUsuario() {
            // Carregar dados do usu√°rio atual
            carregarDadosPerfilUsuario();
            
            // Abrir modal
            const modal = new bootstrap.Modal(document.getElementById('modalPerfilUsuario'));
            modal.show();
        }

        async function carregarDadosPerfilUsuario() {
            try {
                const response = await fetch('/api/usuario/perfil');
                const data = await response.json();
                
                if (data.usuario) {
                    const usuario = data.usuario;
                    
                    // Atualizar informa√ß√µes do perfil
                    document.getElementById('profile-nome').textContent = usuario.nome_completo;
                    document.getElementById('profile-email').textContent = usuario.email;
                    document.getElementById('profile-ultimo-acesso').textContent = usuario.ultimo_acesso || 'Nunca';
                    
                    // Atualizar badge do perfil
                    const perfilBadge = document.getElementById('profile-perfil');
                    const emoji = usuario.perfil === 'admin' ? 'üëë' : usuario.perfil === 'auditor' ? 'üîç' : 'üë§';
                    perfilBadge.innerHTML = `<span class="badge ${usuario.perfil}">${emoji} ${usuario.perfil.charAt(0).toUpperCase() + usuario.perfil.slice(1)}</span>`;
                    
                    // Atualizar avatar
                    const avatar = document.getElementById('profile-avatar');
                    if (usuario.foto_perfil) {
                        avatar.innerHTML = `<img src="${usuario.foto_perfil}" alt="Foto de perfil" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
                    } else {
                        avatar.innerHTML = `<div style="font-size: 2.5rem; font-weight: bold; color: white;">${usuario.nome_completo.charAt(0).toUpperCase()}</div>`;
                    }
                    
                    // Atualizar estat√≠sticas
                    if (usuario.estatisticas) {
                        document.getElementById('stats-extratos').textContent = usuario.estatisticas.extratos || 0;
                        document.getElementById('stats-lancamentos').textContent = usuario.estatisticas.lancamentos || 0;
                        document.getElementById('stats-conciliacoes').textContent = usuario.estatisticas.conciliacoes || 0;
                        document.getElementById('stats-divergencias').textContent = usuario.estatisticas.divergencias || 0;
                    }
                }
            } catch (error) {
                console.error('Erro ao carregar perfil:', error);
                alert('Erro ao carregar dados do perfil');
            }
        }

        function editarDadosPessoais() {
            // Carregar dados atuais nos campos
            document.getElementById('edit-nome').value = document.getElementById('profile-nome').textContent;
            document.getElementById('edit-email').value = document.getElementById('profile-email').textContent;
            
            // Fechar modal do perfil e abrir modal de edi√ß√£o
            const modalPerfil = bootstrap.Modal.getInstance(document.getElementById('modalPerfilUsuario'));
            modalPerfil.hide();
            
            const modalEditar = new bootstrap.Modal(document.getElementById('modalEditarDados'));
            modalEditar.show();
        }

        async function salvarDadosPessoais() {
            const nome = document.getElementById('edit-nome').value;
            const email = document.getElementById('edit-email').value;
            const telefone = document.getElementById('edit-telefone').value;
            
            if (!nome || !email) {
                alert('Nome e email s√£o obrigat√≥rios');
                return;
            }
            
            try {
                const response = await fetch('/api/usuario/perfil', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        nome_completo: nome,
                        email: email,
                        telefone: telefone
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('Dados atualizados com sucesso!');
                    
                    // Fechar modal e recarregar dados
                    const modal = bootstrap.Modal.getInstance(document.getElementById('modalEditarDados'));
                    modal.hide();
                    
                    // Atualizar dados na tela
                    document.getElementById('profile-nome').textContent = nome;
                    document.getElementById('profile-email').textContent = email;
                    
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao salvar dados: ' + error.message);
            }
        }

        function alterarSenha() {
            // Fechar modal do perfil e abrir modal de altera√ß√£o de senha
            const modalPerfil = bootstrap.Modal.getInstance(document.getElementById('modalPerfilUsuario'));
            modalPerfil.hide();
            
            const modalSenha = new bootstrap.Modal(document.getElementById('modalAlterarSenha'));
            modalSenha.show();
        }

        async function salvarNovaSenha() {
            const senhaAtual = document.getElementById('senha-atual').value;
            const novaSenha = document.getElementById('nova-senha').value;
            const confirmarSenha = document.getElementById('confirmar-senha').value;
            
            if (!senhaAtual || !novaSenha || !confirmarSenha) {
                alert('Todos os campos s√£o obrigat√≥rios');
                return;
            }
            
            if (novaSenha !== confirmarSenha) {
                alert('A confirma√ß√£o da senha n√£o confere');
                return;
            }
            
            if (novaSenha.length < 6) {
                alert('A nova senha deve ter pelo menos 6 caracteres');
                return;
            }
            
            try {
                const response = await fetch('/api/usuario/alterar-senha', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        senha_atual: senhaAtual,
                        nova_senha: novaSenha
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('Senha alterada com sucesso!');
                    
                    // Limpar campos e fechar modal
                    document.getElementById('form-alterar-senha').reset();
                    const modal = bootstrap.Modal.getInstance(document.getElementById('modalAlterarSenha'));
                    modal.hide();
                    
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao alterar senha: ' + error.message);
            }
        }

        function configurarPreferencias() {
            alert('Funcionalidade em desenvolvimento!\n\nEm breve voc√™ poder√°:\n‚Ä¢ Configurar tema claro/escuro\n‚Ä¢ Definir idioma\n‚Ä¢ Personalizar notifica√ß√µes\n‚Ä¢ Ajustar configura√ß√µes de relat√≥rios');
        }

        function uploadFotoPerfil() {
            document.getElementById('upload-foto').click();
        }

        function processarFotoPerfil(input) {
            const file = input.files[0];
            if (!file) return;
            
            // Validar tipo de arquivo
            if (!file.type.startsWith('image/')) {
                alert('Apenas arquivos de imagem s√£o permitidos');
                return;
            }
            
            // Validar tamanho (m√°ximo 2MB)
            if (file.size > 2 * 1024 * 1024) {
                alert('A imagem deve ter no m√°ximo 2MB');
                return;
            }
            
            // Preview da imagem
            const reader = new FileReader();
            reader.onload = function(e) {
                const avatar = document.getElementById('profile-avatar');
                avatar.innerHTML = `<img src="${e.target.result}" alt="Foto de perfil" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
            };
            reader.readAsDataURL(file);
            
            // Aqui voc√™ implementaria o upload real
            // uploadFotoParaServidor(file);
            alert('Funcionalidade de upload em desenvolvimento!\nA imagem foi carregada apenas para preview.');
        }

        function abrirConfiguracoes() {
            alert('Configura√ß√µes do Sistema\n\nEm breve voc√™ poder√°:\n‚Ä¢ Personalizar interface\n‚Ä¢ Configurar notifica√ß√µes\n‚Ä¢ Definir prefer√™ncias de relat√≥rios\n‚Ä¢ Gerenciar integra√ß√µes');
        }

        function confirmarLogout() {
            if (confirm('Tem certeza que deseja sair do sistema?')) {
                window.location.href = '/logout';
            }
        }

        // === FUN√á√ïES PARA LOGS DE AUDITORIA ===

        let logsData = [];

        async function carregarLogs() {
            const loading = document.getElementById('loading-logs');
            const tabela = document.getElementById('tabela-logs');
            
            loading.style.display = 'block';
            tabela.style.display = 'none';
            
            try {
                const response = await fetch('/api/auditoria');
                const data = await response.json();
                
                if (Array.isArray(data)) {
                    logsData = data;
                    renderizarLogs(logsData);
                    atualizarEstatisticasLogs(logsData);
                } else {
                    throw new Error('Formato de dados inv√°lido');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao carregar logs: ' + error.message);
            } finally {
                loading.style.display = 'none';
                tabela.style.display = 'table';
            }
        }

        function renderizarLogs(logs) {
            const tbody = document.getElementById('lista-logs');
            
            tbody.innerHTML = logs.map(log => `
                <tr>
                    <td>
                        <small>${log.created_at}</small>
                    </td>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="avatar bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-2" 
                                 style="width: 30px; height: 30px; min-width: 30px; min-height: 30px; font-size: 0.8rem; flex-shrink: 0;">
                                ${log.usuario.charAt(0).toUpperCase()}
                            </div>
                            <span class="text-truncate" style="max-width: 80px;" title="${log.usuario}">${log.usuario}</span>
                        </div>
                    </td>
                    <td>
                        <span class="badge ${getAcaoBadgeClass(log.acao)}">${formatarAcao(log.acao)}</span>
                    </td>
                    <td>
                        <code>${log.tabela || '-'}</code>
                    </td>
                    <td>
                        <small>${log.registro_id || '-'}</small>
                    </td>
                    <td>
                        <small class="text-muted">${log.ip_address || '-'}</small>
                    </td>
                    <td class="text-center">
                        <button class="btn btn-outline-info btn-sm" onclick="verDetalhesLog(${log.id})" title="Ver detalhes">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function getAcaoBadgeClass(acao) {
            const classes = {
                'login': 'bg-success',
                'logout': 'bg-secondary',
                'create': 'bg-primary',
                'update': 'bg-warning',
                'delete': 'bg-danger',
                'resolver_divergencia': 'bg-info'
            };
            return classes[acao] || 'bg-secondary';
        }

        function formatarAcao(acao) {
            const acoes = {
                'login': 'Login',
                'logout': 'Logout',
                'create': 'Criar',
                'update': 'Atualizar',
                'delete': 'Excluir',
                'resolver_divergencia': 'Resolver Diverg√™ncia'
            };
            return acoes[acao] || acao;
        }

        function atualizarEstatisticasLogs(logs) {
            const hoje = new Date().toDateString();
            const logsHoje = logs.filter(log => new Date(log.created_at).toDateString() === hoje);
            const usuariosUnicos = [...new Set(logs.map(log => log.usuario))];
            const acoesCriticas = logs.filter(log => ['delete', 'resolver_divergencia'].includes(log.acao));
            
            document.getElementById('total-logs').textContent = logs.length;
            document.getElementById('logs-hoje').textContent = logsHoje.length;
            document.getElementById('usuarios-ativos').textContent = usuariosUnicos.length;
            document.getElementById('acoes-criticas').textContent = acoesCriticas.length;
        }

        function filtrarLogs() {
            const filtroAcao = document.getElementById('filtro-acao').value;
            const dataFiltro = document.getElementById('data-filtro').value;
            
            let logsFiltrados = logsData;
            
            if (filtroAcao) {
                logsFiltrados = logsFiltrados.filter(log => log.acao === filtroAcao);
            }
            
            if (dataFiltro) {
                logsFiltrados = logsFiltrados.filter(log => 
                    log.created_at.startsWith(dataFiltro)
                );
            }
            
            renderizarLogs(logsFiltrados);
            atualizarEstatisticasLogs(logsFiltrados);
        }

        function verDetalhesLog(logId) {
            const log = logsData.find(l => l.id === logId);
            if (!log) return;
            
            // Preencher modal com dados do log
            document.getElementById('log-data-hora').textContent = log.created_at;
            document.getElementById('log-usuario').textContent = log.usuario;
            document.getElementById('log-ip').textContent = log.ip_address || 'N√£o dispon√≠vel';
            document.getElementById('log-id').textContent = log.id;
            document.getElementById('log-acao').textContent = formatarAcao(log.acao);
            document.getElementById('log-acao').className = `badge ${getAcaoBadgeClass(log.acao)}`;
            document.getElementById('log-tabela').textContent = log.tabela || 'N√£o especificada';
            document.getElementById('log-registro-id').textContent = log.registro_id || 'N√£o dispon√≠vel';
            
            // Dados anteriores e novos (se dispon√≠veis)
            document.getElementById('log-dados-anteriores').textContent = log.dados_anteriores ? 
                JSON.stringify(JSON.parse(log.dados_anteriores), null, 2) : 'N√£o dispon√≠vel';
            document.getElementById('log-dados-novos').textContent = log.dados_novos ? 
                JSON.stringify(JSON.parse(log.dados_novos), null, 2) : 'N√£o dispon√≠vel';
            
            // Abrir modal
            const modal = new bootstrap.Modal(document.getElementById('modalDetalhesLog'));
            modal.show();
        }

        function exportarLogs() {
            const filtroAcao = document.getElementById('filtro-acao').value;
            const dataFiltro = document.getElementById('data-filtro').value;
            
            let logsFiltrados = logsData;
            
            if (filtroAcao) {
                logsFiltrados = logsFiltrados.filter(log => log.acao === filtroAcao);
            }
            
            if (dataFiltro) {
                logsFiltrados = logsFiltrados.filter(log => 
                    log.created_at.startsWith(dataFiltro)
                );
            }
            
            // Converter para CSV
            const headers = ['Data/Hora', 'Usu√°rio', 'A√ß√£o', 'Tabela', 'Registro ID', 'IP Address'];
            const csvContent = [
                headers.join(','),
                ...logsFiltrados.map(log => [
                    log.created_at,
                    log.usuario,
                    formatarAcao(log.acao),
                    log.tabela || '',
                    log.registro_id || '',
                    log.ip_address || ''
                ].join(','))
            ].join('\n');
            
            // Download do arquivo
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `logs_auditoria_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // Carregar logs automaticamente quando a tab for ativada
        document.querySelector('[data-tab="logs"]').addEventListener('click', function() {
            setTimeout(() => {
                if (logsData.length === 0) {
                    carregarLogs();
                }
            }, 100);
        });
    </script>
</body>
</html>
